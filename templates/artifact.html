{% extends 'boilerplates/base_navbar.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Artifact{% endblock %}

{% block content %}
<div class="container-scroller" style="width: 100%; height: 60%">
  <div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title"><a href="{% url 'assignment' course_id %}"><button type="button"
          class="btn btn-outline-primary">Back</button></a>
            &nbsp&nbsp&nbsp&nbsp&nbsp {{ assignment.assignment_name }} - Artifact</h4>
        <div class="table-responsive">
          {% for artifact in artifacts %}
          <div class="card">
            <div class="card-body">
              <div class="row">
                <div class="col-lg-8">
                  <div class="border-bottom text-center pb-4">
                    {{ artifact.file|cut:'assignment_files/' }}
                    {{ artifact.upload_time}}
                  </div>
                </div>
                <div class="col-lg-4">
                  <div class="border-bottom text-center pb-4">
                    {% if userRole == 'Instructor' or userRole == 'TA' or userRole == 'Student'%}
                      <td>
                        <a href="{% url 'download_artifact' course_id assignment.id artifact.id %}">
                          <button type="button" class="btn-sm btn-primary">View</button>
                        </a>
                      </td>
                      <td>
                        <a href="{% url 'edit_artifact' course_id assignment.id artifact.id %}">
                          <button type="button" class="btn-sm btn-primary">Edit</button>
                        </a>
                      </td>
                      <td>
                        <a href="{% url 'delete_artifact' course_id assignment.id artifact.id %}">
                          <button type="button" class="btn-sm btn-primary">Delete</button>
                        </a>
                      </td>
                    {% endif %}
                  </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% if artifacts %}
  <p> <p>
  {% else %}
  {% if userRole == 'Instructor' or userRole == 'TA' or userRole == 'Student' %}
  <div class="col-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <h4 class="card-title">Upload file</h4>
            <input hidden name="entity" class="form-control" id="entity-ID" value="{{ entity.id }}">
            <input hidden name="assignment" class="form-control" id="assignment-ID" value="{{ assignment.id }}">
            <div class="form-group">
                <label for="file">File:</label>
                <input type="file" name="file" style="height: auto; padding: 0.375rem 0.75rem;" class="form-control" id="file" accept=".pdf">
            </div>
            <button type="submit" class="btn btn-primary me-2" id="upload-file">Add</button>
            </form>
        </div>
    </div>
  </div>
  {% endif %}
  {% endif %}
</div>
{% endblock content %}

{% block js %}
{% csrf_token %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"
  integrity="sha512-dw+7hmxlGiOvY3mCnzrPT5yoUwN/MRjVgYV7HGXqsiXnZeqsw1H9n9lsnnPu4kL2nx2bnrjFcuWK+P3lshekwQ=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js"
  integrity="sha512-fahFaRPTP2xrdxAbzgG31V4Vr+Ga/hp4gQu3ZBq83bhKO10NoWfTJ20OWg9ufEyT1Y4ZyCuh9wLHY9CHi6l95Q=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="{% static 'js/survey-template.js' %}"></script>
<script src="{% static 'js/survey-page.js' %}"></script>
<script src="{% static 'js/pdf-carousel.js' %}"></script>
<script src="{% static 'designer/js/jquery.cookie.js' %}"></script>
<script>


  $( "#upload-file" ).click(function() {
    var ajaxCalls = [];
    var ajaxCall = $.ajax({
      url: `/api/constraints/submit_presentation/progress/action`,
      type: 'PUT',
      headers: { "X-CSRFToken": "{{ csrf_token }}" },
      data: {
      },
      success: function (data) {
        console.log("success");
      },
      error: function (data) {
        console.log("error");
      }
    });
    ajaxCalls.push(ajaxCall);
    var ajaxCall = $.ajax({
      url: `/api/rules/progress`,
      type: 'GET',
      headers: { "X-CSRFToken": "{{ csrf_token }}" },
      data: {
      },
      success: function (data) {
        alert(JSON.stringify(data));
      },
      error: function (data) {
        console.log("error");
      }
    });
    ajaxCalls.push(ajaxCall);
    Promise.all(ajaxCalls);
  });
  

</script>
{% endblock js %}